{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/$defs/RawConfig",
  "$defs": {
    "Network": {
      "properties": {
        "lan-access": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "LAN access configuration (currently only '*' is supported)"
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "RawCommands": {
      "properties": {
        "up": true,
        "enter": true
      },
      "additionalProperties": false,
      "type": "object"
    },
    "RawConfig": {
      "properties": {
        "extends": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Config files to extend (declaring file overrides extended files)"
        },
        "includes": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Config files to include (included files override declaring file)"
        },
        "image": {
          "type": "string",
          "description": "Container image to use"
        },
        "workdir": {
          "type": "string",
          "description": "Working directory inside container"
        },
        "workdir_exclude": {
          "items": {
            "type": "string"
          },
          "type": "array",
          "description": "Patterns to exclude from workdir mount (requires Mutagen)"
        },
        "runtime": {
          "type": "string",
          "enum": [
            "auto",
            "docker"
          ],
          "description": "Container runtime selection"
        },
        "commands": {
          "properties": {
            "up": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Command string"
                },
                {
                  "properties": {
                    "command": {
                      "type": "string",
                      "description": "The command string"
                    },
                    "append": {
                      "type": "boolean",
                      "description": "Append to base command during merge (default: false)"
                    }
                  },
                  "additionalProperties": false,
                  "type": "object",
                  "description": "Command with append support"
                }
              ],
              "description": "Command value (string or object with append flag)"
            },
            "enter": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Command string"
                },
                {
                  "properties": {
                    "command": {
                      "type": "string",
                      "description": "The command string"
                    },
                    "append": {
                      "type": "boolean",
                      "description": "Append to base command during merge (default: false)"
                    }
                  },
                  "additionalProperties": false,
                  "type": "object",
                  "description": "Command with append support"
                }
              ],
              "description": "Command value (string or object with append flag)"
            }
          },
          "additionalProperties": false,
          "type": "object",
          "description": "Lifecycle commands"
        },
        "mounts": {
          "$ref": "#/$defs/RawMountSlice"
        },
        "resources": {
          "$ref": "#/$defs/Resources",
          "description": "Container resource limits"
        },
        "envs": {
          "$ref": "#/$defs/RawEnvValueMap"
        },
        "network": {
          "$ref": "#/$defs/Network",
          "description": "Network configuration"
        },
        "caps": {
          "oneOf": [
            {
              "items": {
                "type": "string"
              },
              "type": "array",
              "description": "Additive mode: capabilities to add beyond defaults (CHOWN, DAC_OVERRIDE, FOWNER, KILL, SETUID, SETGID). Drops ALL first."
            },
            {
              "properties": {
                "drop": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array",
                  "description": "Capabilities to drop (e.g., [\"NET_RAW\", \"MKNOD\"])"
                },
                "add": {
                  "items": {
                    "type": "string"
                  },
                  "type": "array",
                  "description": "Capabilities to add (e.g., [\"CHOWN\", \"FOWNER\"])"
                }
              },
              "additionalProperties": false,
              "type": "object",
              "description": "Full control mode: explicit drop and add lists (no implicit defaults)"
            }
          ],
          "description": "Container capability configuration. Array = additive mode, Object = full control mode."
        }
      },
      "additionalProperties": false,
      "type": "object"
    },
    "RawEnvValueMap": {
      "additionalProperties": {
        "oneOf": [
          {
            "type": "string",
            "description": "Static value or ${VAR} reference"
          },
          {
            "properties": {
              "value": {
                "type": "string",
                "description": "The value or ${VAR} reference"
              },
              "override_on_enter": {
                "type": "boolean",
                "description": "Also set at docker exec time"
              }
            },
            "additionalProperties": false,
            "type": "object"
          }
        ],
        "description": "Environment variable value (string or object with override_on_enter)"
      },
      "type": "object",
      "description": "Environment variables for the container"
    },
    "RawMountSlice": {
      "items": {
        "oneOf": [
          {
            "type": "string",
            "description": "Simple format: source:target[:ro]"
          },
          {
            "properties": {
              "source": {
                "type": "string",
                "description": "Host path (required)"
              },
              "target": {
                "type": "string",
                "description": "Container path (required)"
              },
              "readonly": {
                "type": "boolean",
                "description": "Read-only mount (default: false)"
              },
              "exclude": {
                "items": {
                  "type": "string"
                },
                "type": "array",
                "description": "Glob patterns to exclude (optional)"
              }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
              "source",
              "target"
            ],
            "description": "Extended format with excludes"
          }
        ]
      },
      "type": "array",
      "description": "Additional bind mounts"
    },
    "Resources": {
      "properties": {
        "memory": {
          "type": "string",
          "description": "Memory limit (e.g. 4g or 512m)"
        },
        "cpus": {
          "type": "integer",
          "description": "Number of CPUs to allocate"
        }
      },
      "additionalProperties": false,
      "type": "object"
    }
  },
  "title": "Alcatraz Configuration",
  "description": "Configuration schema for .alca.toml files"
}