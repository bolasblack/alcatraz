<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='Network Configuration# By default, Alcatraz containers can access the internet but cannot access your local network (LAN). This prevents AI agents from reaching local services, databases, or other machines on your network.
Quick Summary# Scenario Internet LAN Config needed Default (no config) Yes No None Allow specific LAN access Yes Configured hosts lan-access = [...] Allow all LAN access Yes Yes lan-access = ["*"] Why nftables Inside the VM?# On macOS, both Docker Desktop and OrbStack run containers inside a Linux VM. Container network traffic does not pass through macOS kernel network interfaces — instead it is handled entirely in userspace:
'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://bolasblack.github.io/alcatraz/config/network/"><meta property="og:site_name" content="Alcatraz"><meta property="og:title" content="Network Configuration"><meta property="og:description" content='Network Configuration# By default, Alcatraz containers can access the internet but cannot access your local network (LAN). This prevents AI agents from reaching local services, databases, or other machines on your network.
Quick Summary# Scenario Internet LAN Config needed Default (no config) Yes No None Allow specific LAN access Yes Configured hosts lan-access = [...] Allow all LAN access Yes Yes lan-access = ["*"] Why nftables Inside the VM?# On macOS, both Docker Desktop and OrbStack run containers inside a Linux VM. Container network traffic does not pass through macOS kernel network interfaces — instead it is handled entirely in userspace:'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="config"><meta property="article:modified_time" content="2026-02-12T11:43:14+00:00"><meta itemprop=name content="Network Configuration"><meta itemprop=description content='Network Configuration# By default, Alcatraz containers can access the internet but cannot access your local network (LAN). This prevents AI agents from reaching local services, databases, or other machines on your network.
Quick Summary# Scenario Internet LAN Config needed Default (no config) Yes No None Allow specific LAN access Yes Configured hosts lan-access = [...] Allow all LAN access Yes Yes lan-access = ["*"] Why nftables Inside the VM?# On macOS, both Docker Desktop and OrbStack run containers inside a Linux VM. Container network traffic does not pass through macOS kernel network interfaces — instead it is handled entirely in userspace:'><meta itemprop=dateModified content="2026-02-12T11:43:14+00:00"><meta itemprop=wordCount content="907"><title>Network Configuration | Alcatraz</title><link rel=icon href=/alcatraz/favicon.png><link rel=manifest href=/alcatraz/manifest.json><link rel=canonical href=https://bolasblack.github.io/alcatraz/config/network/><link rel=stylesheet href=/alcatraz/book.min.e61afb4afdceff9939c266b263897a4a31d9a9e94045925e6d1774fe776b6a6d.css integrity="sha256-5hr7Sv3O/5k5wmayY4l6SjHZqelARZJebRd0/ndram0=" crossorigin=anonymous><script defer src=/alcatraz/fuse.min.js></script><script defer src=/alcatraz/en.search.min.af11d85036dc5e57471423614e71f7ef475c38cae286fd5120309ab0cce8d468.js integrity="sha256-rxHYUDbcXldHFCNhTnH370dcOMrihv1RIDCasMzo1Gg=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-config"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/alcatraz/><span>Alcatraz</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/alcatraz/quickstart/>Quickstart</a></li><li><input type=checkbox id=section-574f9361c1a9cdabce6f05eeb167dbcc class=toggle checked>
<label for=section-574f9361c1a9cdabce6f05eeb167dbcc class=flex><a href=/alcatraz/config/>Configuration</a>
<img src=/alcatraz/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/alcatraz/config/extends-includes/>Extends & Includes</a></li><li><a href=/alcatraz/config/fields/>Field Reference</a></li><li><a href=/alcatraz/config/network/ class=active>Network Configuration</a></li></ul></li><li><a href=/alcatraz/runtimes/>Runtimes</a></li><li><a href=/alcatraz/sync-conflicts/>Sync Conflicts</a></li><li><input type=checkbox id=section-598a1865d4bd87c7fa2da993de5e0d3e class=toggle>
<label for=section-598a1865d4bd87c7fa2da993de5e0d3e class=flex><a role=button>Command Reference</a>
<img src=/alcatraz/icons/chevron-right.svg class=book-icon alt=Expand></label><ul><li><a href=/alcatraz/commands/alca/>alca</a></li><li><a href=/alcatraz/commands/alca_cleanup/>alca cleanup</a></li><li><a href=/alcatraz/commands/alca_down/>alca down</a></li><li><a href=/alcatraz/commands/alca_experimental/>alca experimental</a></li><li><a href=/alcatraz/commands/alca_experimental_reload/>alca experimental reload</a></li><li><a href=/alcatraz/commands/alca_experimental_sync/>alca experimental sync</a></li><li><a href=/alcatraz/commands/alca_experimental_sync_check/>alca experimental sync check</a></li><li><a href=/alcatraz/commands/alca_experimental_sync_resolve/>alca experimental sync resolve</a></li><li><a href=/alcatraz/commands/alca_init/>alca init</a></li><li><a href=/alcatraz/commands/alca_list/>alca list</a></li><li><a href=/alcatraz/commands/alca_network-helper/>alca network-helper</a></li><li><a href=/alcatraz/commands/alca_network-helper_install/>alca network-helper install</a></li><li><a href=/alcatraz/commands/alca_network-helper_status/>alca network-helper status</a></li><li><a href=/alcatraz/commands/alca_network-helper_uninstall/>alca network-helper uninstall</a></li><li><a href=/alcatraz/commands/alca_run/>alca run</a></li><li><a href=/alcatraz/commands/alca_status/>alca status</a></li><li><a href=/alcatraz/commands/alca_up/>alca up</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/alcatraz/icons/menu.svg class=book-icon alt=Menu></label><h3>Network Configuration</h3><label for=toc-control><img src=/alcatraz/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#quick-summary>Quick Summary</a></li><li><a href=#why-nftables-inside-the-vm>Why nftables Inside the VM?</a></li><li><a href=#networklan-access>network.lan-access</a></li><li><a href=#platform-behavior>Platform Behavior</a></li><li><a href=#network-helper>Network Helper</a><ul><li><a href=#commands>Commands</a></li><li><a href=#automatic-installation>Automatic Installation</a></li><li><a href=#macos-vmhelper-container>macOS: vmhelper Container</a></li><li><a href=#linux-native-nftables>Linux: Native nftables</a></li></ul></li><li><a href=#how-it-works>How It Works</a></li><li><a href=#without-alcatraz>Without Alcatraz</a></li><li><a href=#manual-cleanup>Manual Cleanup</a><ul><li><a href=#macos>macOS</a></li><li><a href=#linux>Linux</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=network-configuration>Network Configuration<a class=anchor href=#network-configuration>#</a></h1><p>By default, Alcatraz containers can access the internet but <strong>cannot access your local network (LAN)</strong>. This prevents AI agents from reaching local services, databases, or other machines on your network.</p><h2 id=quick-summary>Quick Summary<a class=anchor href=#quick-summary>#</a></h2><table><thead><tr><th>Scenario</th><th>Internet</th><th>LAN</th><th>Config needed</th></tr></thead><tbody><tr><td>Default (no config)</td><td>Yes</td><td>No</td><td>None</td></tr><tr><td>Allow specific LAN access</td><td>Yes</td><td>Configured hosts</td><td><code>lan-access = [...]</code></td></tr><tr><td>Allow all LAN access</td><td>Yes</td><td>Yes</td><td><code>lan-access = ["*"]</code></td></tr></tbody></table><h2 id=why-nftables-inside-the-vm>Why nftables Inside the VM?<a class=anchor href=#why-nftables-inside-the-vm>#</a></h2><p>On macOS, both Docker Desktop and OrbStack run containers inside a Linux VM. Container network traffic does not pass through macOS kernel network interfaces — instead it is handled entirely in userspace:</p><ul><li><strong>Docker Desktop</strong> uses <a href=https://www.docker.com/blog/how-docker-desktop-networking-works-under-the-hood/>vpnkit</a>, a userspace TCP/IP stack that reads raw ethernet frames from the VM over a shared-memory channel and translates them into regular macOS socket calls via the <code>com.docker.backend</code> process. Docker&rsquo;s security documentation <a href=https://docs.docker.com/security/faqs/networking-and-vms/>explicitly describes</a> this as &ldquo;a user-space process (<code>com.docker.vpnkit</code>) for network connectivity instead of kernel-level networking.&rdquo;</li><li><strong>OrbStack</strong> uses a <a href=https://docs.orbstack.dev/architecture>custom-built virtual network stack</a> that is &ldquo;purpose-built from scratch.&rdquo; The <a href=https://docs.orbstack.dev/docker/network>45 Gbps throughput</a> between macOS and Linux confirms shared-memory transport rather than kernel network interfaces.</li></ul><p>Since macOS <code>pf</code> (packet filter) operates on kernel network interfaces, it <strong>cannot intercept container traffic</strong> on either platform. Docker&rsquo;s own documentation <a href=https://docs.docker.com/security/faqs/networking-and-vms/>recommends</a> applying process-level firewall rules to <code>com.docker.backend</code> instead, but this only provides coarse-grained control (all containers or none). Per-container firewall rules must be applied inside the Linux VM using <a href=https://docs.docker.com/engine/network/firewall-nftables>nftables</a>, which is exactly what Alcatraz does automatically.</p><p>On Linux, containers run natively, and Alcatraz uses the system&rsquo;s native nftables directly.</p><h2 id=networklan-access>network.lan-access<a class=anchor href=#networklan-access>#</a></h2><p>Allow containers to access LAN hosts.</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#111>[</span><span style=color:#75af00>network</span><span style=color:#111>]</span>
</span></span><span style=display:flex><span><span style=color:#75af00>lan-access</span> <span style=color:#111>=</span> <span style=color:#111>[</span><span style=color:#d88200>&#34;*&#34;</span><span style=color:#111>]</span></span></span></code></pre></div><ul><li><strong>Type</strong>: array of strings</li><li><strong>Required</strong>: No</li><li><strong>Default</strong>: <code>[]</code> (no LAN access)</li><li><strong>Valid values</strong>: <code>"*"</code> (allow all LAN access)</li></ul><h2 id=platform-behavior>Platform Behavior<a class=anchor href=#platform-behavior>#</a></h2><p>Both macOS and Linux use <strong>nftables</strong> for network isolation and LAN access rules.</p><table><thead><tr><th>Platform</th><th>Runtime</th><th>Mechanism</th><th>Helper</th></tr></thead><tbody><tr><td>macOS</td><td>OrbStack</td><td>nftables via vmhelper container (nsenter into VM)</td><td><code>alcatraz-network-helper</code> Docker container</td></tr><tr><td>macOS</td><td>Docker Desktop</td><td>nftables via vmhelper container (nsenter into VM)</td><td><code>alcatraz-network-helper</code> Docker container</td></tr><tr><td>Linux</td><td>Docker/Podman</td><td>Native nftables</td><td>Include in <code>/etc/nftables.conf</code></td></tr></tbody></table><h2 id=network-helper>Network Helper<a class=anchor href=#network-helper>#</a></h2><p>The network helper manages nftables firewall rules for container network isolation. It works on both macOS and Linux, with platform-specific implementations.</p><h3 id=commands>Commands<a class=anchor href=#commands>#</a></h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Install (requires sudo on Linux)</span>
</span></span><span style=display:flex><span>alca network-helper install
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check status</span>
</span></span><span style=display:flex><span>alca network-helper status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Uninstall</span>
</span></span><span style=display:flex><span>alca network-helper uninstall</span></span></code></pre></div><h3 id=automatic-installation>Automatic Installation<a class=anchor href=#automatic-installation>#</a></h3><p>When running <code>alca up</code> with <code>lan-access</code> configured (or when network isolation is needed), Alcatraz checks if the network helper is installed. If not, it offers to install it automatically:</p><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Network helper required for LAN access.
</span></span><span style=display:flex><span>Install now? [y/N]</span></span></code></pre></div><h3 id=macos-vmhelper-container>macOS: vmhelper Container<a class=anchor href=#macos-vmhelper-container>#</a></h3><p>On macOS, containers run inside a Linux VM managed by OrbStack or Docker Desktop. Alcatraz cannot use macOS-level firewalls (like pf) because container traffic is handled in userspace and never passes through the macOS kernel&rsquo;s network stack.</p><p>Instead, Alcatraz runs a helper container (<code>alcatraz-network-helper</code>) that applies nftables rules <strong>inside the VM</strong> using <code>nsenter</code>:</p><ol><li>Rule files (<code>.nft</code>) are written to <code>~/.alcatraz/files/alcatraz_nft/</code></li><li>The helper container mounts <code>~/.alcatraz/files/</code> and watches for changes</li><li>Rules are loaded via <code>nsenter -t 1 -m -u -n -i sh -c 'nft -f /dev/stdin' &lt; "$f"</code> to cross mount namespace boundaries</li><li>The helper also responds to SIGHUP for on-demand reloads</li></ol><p><strong>Install</strong> creates:</p><ul><li><code>~/.alcatraz/files/alcatraz_nft/</code> directory for rule files</li><li><code>~/.alcatraz/files/alcatraz_network_helper/entry.sh</code> script</li><li><code>alcatraz-network-helper</code> Docker container (privileged, <code>--pid=host</code>, <code>--net=host</code>, <code>--restart=always</code>)</li></ul><p><strong>Uninstall</strong> removes the <code>alcatraz-network-helper</code> container.</p><h3 id=linux-native-nftables>Linux: Native nftables<a class=anchor href=#linux-native-nftables>#</a></h3><p>On Linux, Alcatraz uses the system&rsquo;s native nftables directly.</p><p><strong>Install</strong> creates:</p><ul><li><code>/etc/nftables.d/alcatraz/</code> directory for rule files</li><li>Include line in <code>/etc/nftables.conf</code>: <code>include "/etc/nftables.d/alcatraz/*.nft"</code></li><li>Enables and reloads <code>nftables.service</code></li></ul><p><strong>Uninstall</strong> removes:</p><ul><li>All rule files from <code>/etc/nftables.d/alcatraz/</code></li><li>The include line from <code>/etc/nftables.conf</code></li><li>All <code>alca-*</code> nftables tables</li><li>The <code>/etc/nftables.d/alcatraz/</code> directory</li></ul><h2 id=how-it-works>How It Works<a class=anchor href=#how-it-works>#</a></h2><ol><li><p>On <code>alca up</code>, if <code>lan-access</code> is configured or network isolation is needed:</p><ul><li>Checks if the network helper is installed; offers to install if not</li><li>Writes per-container nftables rule files</li><li>Loads rules via the platform-specific mechanism</li></ul></li><li><p>On <code>alca down</code>:</p><ul><li>Removes per-container rule files</li><li>Cleans up container-specific nftables tables</li></ul></li></ol><p>For design rationale, see <a href=https://github.com/bolasblack/alcatraz/blob/master/.agents/decisions/AGD-030_orbstack-nftables-network-isolation.md>AGD-030</a>.</p><h2 id=without-alcatraz>Without Alcatraz<a class=anchor href=#without-alcatraz>#</a></h2><p>For context, here&rsquo;s what manual LAN isolation requires on macOS:</p><ol><li>Run a privileged container or use <code>nsenter</code> to access the Docker Desktop / OrbStack VM&rsquo;s network namespace</li><li>Write nftables or iptables rules blocking traffic to private IP ranges (<code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>)</li><li>Handle rule persistence — rules are lost on VM restart and must be reapplied</li><li>Manage per-container rule lifecycle (create on start, clean up on stop)</li></ol><p>Alcatraz automates all of this through the network helper.</p><h2 id=manual-cleanup>Manual Cleanup<a class=anchor href=#manual-cleanup>#</a></h2><p>If Alcatraz is broken, you can clean up manually:</p><h3 id=macos>macOS<a class=anchor href=#macos>#</a></h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># View running helper container</span>
</span></span><span style=display:flex><span>docker inspect alcatraz-network-helper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove helper container</span>
</span></span><span style=display:flex><span>docker rm -f alcatraz-network-helper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># View active nftables rules inside the VM (OrbStack)</span>
</span></span><span style=display:flex><span>docker run --rm --privileged --pid<span style=color:#f92672>=</span>host alpine nsenter -t <span style=color:#ae81ff>1</span> -m -u -n -i nft list tables
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Delete all alcatraz nftables tables inside the VM</span>
</span></span><span style=display:flex><span>docker run --rm --privileged --pid<span style=color:#f92672>=</span>host alpine sh -c <span style=color:#d88200>&#39;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  nsenter -t 1 -m -u -n -i nft list tables | grep &#34;inet alca-&#34; | while read _ _ table; do
</span></span></span><span style=display:flex><span><span style=color:#d88200>    nsenter -t 1 -m -u -n -i nft delete table inet &#34;$table&#34;
</span></span></span><span style=display:flex><span><span style=color:#d88200>  done
</span></span></span><span style=display:flex><span><span style=color:#d88200>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove rule files</span>
</span></span><span style=display:flex><span>rm -rf ~/.alcatraz/files/alcatraz_nft/
</span></span><span style=display:flex><span>rm -rf ~/.alcatraz/files/alcatraz_network_helper/</span></span></code></pre></div><h3 id=linux>Linux<a class=anchor href=#linux>#</a></h3><div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># View active alcatraz nftables tables</span>
</span></span><span style=display:flex><span>sudo nft list tables <span style=color:#111>|</span> grep alca-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Delete all alcatraz tables</span>
</span></span><span style=display:flex><span>sudo nft list tables <span style=color:#111>|</span> grep <span style=color:#d88200>&#34;inet alca-&#34;</span> <span style=color:#111>|</span> <span style=color:#00a8c8>while</span> <span style=color:#111>read</span> _ _ table<span style=color:#111>;</span> <span style=color:#00a8c8>do</span>
</span></span><span style=display:flex><span>  sudo nft delete table inet <span style=color:#d88200>&#34;</span><span style=color:#111>$table</span><span style=color:#d88200>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove rule files and directory</span>
</span></span><span style=display:flex><span>sudo rm -rf /etc/nftables.d/alcatraz/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remove include line from nftables.conf (edit manually)</span>
</span></span><span style=display:flex><span>sudo vi /etc/nftables.conf
</span></span><span style=display:flex><span><span style=color:#75715e># Remove the line: include &#34;/etc/nftables.d/alcatraz/*.nft&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Reload nftables</span>
</span></span><span style=display:flex><span>sudo nft -f /etc/nftables.conf</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/alcatraz/config/fields/ class="flex align-center"><img src=/alcatraz/icons/backward.svg class=book-icon alt=Backward>
<span>Field Reference</span>
</a></span><span><a href=/alcatraz/runtimes/ class="flex align-center"><span>Runtimes</span>
<img src=/alcatraz/icons/forward.svg class=book-icon alt=Forward></a></span></div><div class=book-comments></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#quick-summary>Quick Summary</a></li><li><a href=#why-nftables-inside-the-vm>Why nftables Inside the VM?</a></li><li><a href=#networklan-access>network.lan-access</a></li><li><a href=#platform-behavior>Platform Behavior</a></li><li><a href=#network-helper>Network Helper</a><ul><li><a href=#commands>Commands</a></li><li><a href=#automatic-installation>Automatic Installation</a></li><li><a href=#macos-vmhelper-container>macOS: vmhelper Container</a></li><li><a href=#linux-native-nftables>Linux: Native nftables</a></li></ul></li><li><a href=#how-it-works>How It Works</a></li><li><a href=#without-alcatraz>Without Alcatraz</a></li><li><a href=#manual-cleanup>Manual Cleanup</a><ul><li><a href=#macos>macOS</a></li><li><a href=#linux>Linux</a></li></ul></li></ul></nav></div></aside></main><script defer src=/alcatraz/code-copy.min.js></script></body></html>